# 一、服务端配置```IP 192.168.123.136```## 服务安装及配置### 安装```yum install -y nfs-utils rpcbind```### 启动及开机自启动```systemctl start rpcbindsystemctl enable rpcbind```### 查看启动情况```[root@backup_host ~]# systemctl status rpcbind● rpcbind.service - RPC bind service   Loaded: loaded (/usr/lib/systemd/system/rpcbind.service; enabled; vendor preset: enabled)   Active: active (running) since Sat 2018-07-07 10:49:29 CST; 3 days ago Main PID: 24718 (rpcbind)   CGroup: /system.slice/rpcbind.service           └─24718 /sbin/rpcbind -wJul 07 10:49:29 backup_host systemd[1]: Starting RPC bind service...Jul 07 10:49:29 backup_host systemd[1]: Started RPC bind service.``````[root@backup_host ~]# rpcinfo -p localhost #启动NFS过后rpcbind服务已经启用了对FNS的端口映射   program vers proto   port  service    100000    4   tcp    111  portmapper    100000    3   tcp    111  portmapper    100000    2   tcp    111  portmapper    100000    4   udp    111  portmapper    100000    3   udp    111  portmapper    100000    2   udp    111  portmapper    100005    1   udp  20048  mountd    100005    1   tcp  20048  mountd    100005    2   udp  20048  mountd    100005    2   tcp  20048  mountd    100005    3   udp  20048  mountd    100005    3   tcp  20048  mountd    100003    3   tcp   2049  nfs    100003    4   tcp   2049  nfs    100227    3   tcp   2049  nfs_acl    100003    3   udp   2049  nfs    100003    4   udp   2049  nfs    100227    3   udp   2049  nfs_acl    100021    1   udp  59137  nlockmgr    100021    3   udp  59137  nlockmgr    100021    4   udp  59137  nlockmgr    100021    1   tcp  45702  nlockmgr    100021    3   tcp  45702  nlockmgr    100021    4   tcp  45702  nlockmgr```### 配置nfs目录```[root@backup_host ~]# cat /etc/exports/storages/iso_files 192.168.123.0/24(rw,no_root_squash,no_all_squash,sync)#共享目录======共享给谁访问====限制的权限列表#限制的权限列表#rw //读写#ro //只读#sync //同步模式，内存数据实时写入磁盘#async //非同步模式#no_root_squash //客户端挂载NFS共享目录后，root用户不受约束，权限很大#root_squash //root用户也要受到限制，被限定成某个普通用户#all_squash //客户端上所有用户在使用NFS共享目录时都被限定为一个普通用户#anonuid/anongid //定义被限定的uid和gid```### 平滑重启nfs```exportfs -r```### 查看本机挂在情况```[root@backup_host ~]# showmount -e 127.0.0.1Export list for 127.0.0.1:/storages/iso_files 192.168.123.0/24```# 二、客户端配置```IP: 192.168.123.139```客户端也需要安装rpcbind和nfs-utils软件，并且设置开机自启动。(只需要启动rpcbind即可### 安装```yum install -y nfs-utils rpcbind```### 启动及开机自启动```systemctl start rpcbindsystemctl enable rpcbind```### 客户端测试服务端通信情况```[root@vnc-139 ~]# rpcinfo -p 192.168.123.136   program vers proto   port  service    100000    4   tcp    111  portmapper    100000    3   tcp    111  portmapper    100000    2   tcp    111  portmapper    100000    4   udp    111  portmapper    100000    3   udp    111  portmapper    100000    2   udp    111  portmapper    100005    1   udp  20048  mountd    100005    1   tcp  20048  mountd    100005    2   udp  20048  mountd    100005    2   tcp  20048  mountd    100005    3   udp  20048  mountd    100005    3   tcp  20048  mountd    100003    3   tcp   2049  nfs    100003    4   tcp   2049  nfs    100227    3   tcp   2049  nfs_acl    100003    3   udp   2049  nfs    100003    4   udp   2049  nfs    100227    3   udp   2049  nfs_acl    100021    1   udp  59137  nlockmgr    100021    3   udp  59137  nlockmgr    100021    4   udp  59137  nlockmgr    100021    1   tcp  45702  nlockmgr    100021    3   tcp  45702  nlockmgr    100021    4   tcp  45702  nlockmgr```### 客户端挂在nfs```mount -t nfs 192.168.123.136:/storages/iso_files /nfsdir/```#### 查看挂在情况```[root@vnc-139 ~]# mountstats /nfsdir/Stats for 192.168.123.136:/storages/iso_files mounted on /nfsdir:  NFS mount options: rw,vers=4.1,rsize=262144,wsize=262144,namlen=255,acregmin=3,acregmax=60,acdirmin=30,acdirmax=60,hard,proto=tcp,port=0,timeo=600,retrans=2,sec=sys,clientaddr=192.168.123.139,local_lock=none  NFS server capabilities: caps=0x3ffdf,wtmult=512,dtsize=32768,bsize=0,namlen=255  NFSv4 capability flags: bm0=0xfdffbfff,bm1=0x40f9be3e,bm2=0x803,acl=0x3,sessions,pnfs=notconfigured  NFS security flavor: 1  pseudoflavor: 0NFS byte counts:  applications read 0 bytes via read(2)  applications wrote 0 bytes via write(2)  applications read 0 bytes via O_DIRECT read(2)  applications wrote 0 bytes via O_DIRECT write(2)  client read 0 bytes via NFS READ  client wrote 0 bytes via NFS WRITERPC statistics:  32 RPC requests sent, 32 RPC replies received (0 XIDs not found)  average backlog queue length: 0LOOKUP:	3 ops (9%) 	avg bytes sent per op: 194	avg bytes received per op: 160	backlog wait: 0.000000 	RTT: 0.000000 	total execute time: 0.000000 (milliseconds)ACCESS:	2 ops (6%) 	avg bytes sent per op: 180	avg bytes received per op: 168	backlog wait: 0.000000 	RTT: 0.000000 	total execute time: 0.000000 (milliseconds)GETATTR:	2 ops (6%) 	avg bytes sent per op: 172	avg bytes received per op: 240	backlog wait: 0.000000 	RTT: 0.000000 	total execute time: 0.000000 (milliseconds)SERVER_CAPS:	2 ops (6%) 	avg bytes sent per op: 172	avg bytes received per op: 160	backlog wait: 0.000000 	RTT: 0.000000 	total execute time: 0.000000 (milliseconds)FSINFO:	1 ops (3%) 	avg bytes sent per op: 172	avg bytes received per op: 164	backlog wait: 0.000000 	RTT: 0.000000 	total execute time: 0.000000 (milliseconds)PATHCONF:	1 ops (3%) 	avg bytes sent per op: 164	avg bytes received per op: 116	backlog wait: 0.000000 	RTT: 0.000000 	total execute time: 0.000000 (milliseconds)``````[root@vnc-139 ~]# ls -l /nfsdir/total 6867592-rw-r--r-- 1 root root  427819008 Jul 11 13:11 CentOS-6.9-x86_64-minimal.iso-rw-r--r-- 1 root root  830472192 Jun  9 14:12 CentOS-7-x86_64-Minimal-1708.iso-rw-r--r-- 1 root root 3419052032 Jun  9 14:17 cn_windows_7_ultimate_with_sp1_x64_dvd_618537.iso-rw-r--r-- 1 root root 1624211456 Mar  1 03:15 ubuntu-16.04.4-desktop-amd64.iso-rw-r--r-- 1 root root  730857472 Jul  6 20:34 XenServer-7.5.0-install-cd.iso```