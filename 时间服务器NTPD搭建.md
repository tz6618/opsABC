# 一、服务端配置## 安装ntpd服务服务端IP：192.168.123.50```yum install ntpdate ntp -y```## 配置文件cat /etc/ntp.conf ```driftfile /var/lib/ntp/driftrestrict default nomodify notrap nopeer noqueryrestrict 127.0.0.1 restrict ::1restrict 192.168.123.0 mask 255.255.255.0 nomodify notrapserver 210.72.145.44 #指定本ntp服务器的上游ntp服务器为210.72.145.44，并且设置为首先服务器。同步时间为：从上到下，写的越靠上，优先级越高。（此服务器同步不了时间，寻找下一个ntp服务器）。此IP地址是中国国家授时中心ntp服务器。server 133.100.11.8 #当上面服务器同步不了，则寻找第二个。此IP地址是日本福冈大学ntp服务器。server 0.centos.pool.ntp.org iburstserver 1.centos.pool.ntp.org iburstserver 2.centos.pool.ntp.org iburstserver 3.centos.pool.ntp.org iburstserver 127.127.1.0 #local clock 如果上面的服务器都无法同步时间，就和本地系统时间同步。127.127.1.0在这里是一个IP地址，不是网段fudge 127.127.1.0 stratum #127.127.1.0 为第10层。ntp 和127.127.1.0同步完后，就变成了11层。  ntp是层次阶级的。同步上层服务器的stratum 大小不能超过或等于16#broadcast 192.168.1.255 autokey	# broadcast server#broadcastclient			# broadcast client#broadcast 224.0.1.1 autokey		# multicast server#multicastclient 224.0.1.1		# multicast client#manycastserver 239.255.254.254		# manycast server#manycastclient 239.255.254.254 autokey # manycast clientincludefile /etc/ntp/crypto/pwkeys /etc/ntp/keys#trustedkey 4 8 42#requestkey 8#controlkey 8disable monitor```## 启动```systemctl start ntpdsystemctl enable ntpd```## 查看服务及同步情况```[root@xen-server ~]# netstat -ntulp | grep ntpdudp        0      0 192.168.123.50:123      0.0.0.0:*                           31388/ntpd          udp        0      0 127.0.0.1:123           0.0.0.0:*                           31388/ntpd          udp        0      0 0.0.0.0:123             0.0.0.0:*                           31388/ntpd          udp6       0      0 :::123                  :::*                                31388/ntpd          [root@xen-server ~]# systemctl status ntpd● ntpd.service - Network Time Service   Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled)  Drop-In: /etc/systemd/system/ntpd.service.d           └─slice.conf   Active: active (running) since Wed 2018-07-11 09:46:00 CST; 11min ago  Process: 31386 ExecStart=/usr/sbin/ntpd -u ntp:ntp $OPTIONS (code=exited, status=0/SUCCESS) Main PID: 31388 (ntpd)   CGroup: /control.slice/ntpd.service           └─31388 /usr/sbin/ntpd -u ntp:ntp -g[root@xen-server ~]# ntpq -p     remote           refid      st t when poll reach   delay   offset  jitter============================================================================== 210.72.145.44   .INIT.          16 u    -  128    0    0.000    0.000   0.000xclock.tl.fukuok 133.100.11.28    2 u  126   64  372  232.503  2830.32 1098.10 idc.ly.ha       .INIT.          16 u    -  256    0    0.000    0.000   0.000*dns2.synet.edu. 202.118.1.46     2 u   41   64  377   32.090  4007.66 504.029 120.132.6.225   10.222.222.22    2 u  450   64  100  1105.00  3189.67 389.710+time4.aliyun.co 10.137.53.7      2 u   45   64  377   57.857  4624.38 736.307 LOCAL(0)        .LOCL.           5 l  721   64    0    0.000    0.000   0.000[root@xen-server ~]#```# 二、客户端配置### 安装ntpdate命令```yum install ntpdate -y```### 测试```[root@backup_host ~]# ntpdate 192.168.123.50 && /sbin/hwclock --systohc 11 Jul 09:56:04 ntpdate[21435]: step time server 192.168.123.50 offset -4.576025 sec```### 添加crontab每10分钟同步一次时间，并且同步硬件时钟```crontab -e*/10 * * * * /usr/sbin/ntpdate 192.168.123.50 && /sbin/hwclock --systohc```